<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_GPP">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" />
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h2 id="gpp.client" c_name="GPPClient" python_name="GPP.Client">GPP.Client</h2>

<p class="graphviz">
<!-- Generated by graphviz version 2.38.0 (20140413.2041) --><!-- Title: %3 Pages: 1 --><svg width="110pt" height="116pt" viewBox="0.00 0.00 110.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)"><title>%3</title><polygon fill="white" stroke="none" points="-4,4 -4,-112 106,-112 106,4 -4,4"/><!-- GObject.Object --><g id="node1" class="node"><title>GObject.Object</title><g id="a_node1"><a xlink:href="https://developer.gnome.org/gobject/unstable//gobject-The-Base-Object-Type.html#GObject" xlink:title="GObject.Object"><path fill="none" stroke="black" d="M90,-108C90,-108 12,-108 12,-108 6,-108 0,-102 0,-96 0,-96 0,-84 0,-84 0,-78 6,-72 12,-72 12,-72 90,-72 90,-72 96,-72 102,-78 102,-84 102,-84 102,-96 102,-96 102,-102 96,-108 90,-108"/><text text-anchor="middle" x="51" y="-86.3" font-family="Times,serif" font-size="14.00">GObject.Object</text></a></g></g><!-- GPP.Client --><g id="node2" class="node"><title>GPP.Client</title><g id="a_node2"><a xlink:href="#gpp.client" xlink:title="GPP.Client"><path fill="none" stroke="black" d="M78,-36C78,-36 24,-36 24,-36 18,-36 12,-30 12,-24 12,-24 12,-12 12,-12 12,-6 18,-0 24,-0 24,-0 78,-0 78,-0 84,-0 90,-6 90,-12 90,-12 90,-24 90,-24 90,-30 84,-36 78,-36"/><text text-anchor="middle" x="51" y="-14.3" font-family="Times,serif" font-size="14.00">GPP.Client</text></a></g></g><!-- GObject.Object&#45;&gt;GPP.Client --><g id="edge1" class="edge"><title>GObject.Object&#45;&gt;GPP.Client</title><path fill="none" stroke="black" d="M51,-71.6966C51,-63.9827 51,-54.7125 51,-46.1124"/><polygon fill="black" stroke="black" points="54.5001,-46.1043 51,-36.1043 47.5001,-46.1044 54.5001,-46.1043"/></g></g></svg></p>

<p><a href="#gpp.client">GPP.Client</a> sends requests to a <a href="#gpp.queue">GPP.Queue</a>, and emits a signal
with the possible reply and the status of the task once it has been executed.</p>

<p>A per-request retry limit can be set when calling <a href="#gpp.client.send_request">GPP.Client.send_request</a></p>

<blockquote>
<p>Set up and start a simple client, which will send requests for numbers to be multiplied, and will not take &lsquo;No&rsquo; for an answer.</p>
</blockquote>
<pre class="highlight c"><code><span class="cp">#include &lt;glib-unix.h&gt;
#include "gpp.h"
</span>
<span class="k">static</span> <span class="n">gchar</span> <span class="o">*</span>
<span class="nf">make_new_task</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">sequence</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">gchar</span> <span class="o">*</span><span class="n">task</span> <span class="o">=</span> <span class="n">g_strdup_printf</span> <span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">sequence</span><span class="p">);</span>
  <span class="n">sequence</span><span class="o">++</span><span class="p">;</span>

  <span class="n">g_print</span> <span class="p">(</span><span class="s">"Doing task %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">task</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">task_done_cb</span> <span class="p">(</span><span class="n">GPPClient</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="n">gboolean</span> <span class="n">success</span><span class="p">,</span> <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">reply</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">unused</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"task failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"task succeeded : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">reply</span><span class="p">);</span>
  <span class="n">gpp_client_send_request</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">make_new_task</span> <span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">gboolean</span>
<span class="nf">interrupted_cb</span> <span class="p">(</span><span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_main_loop_quit</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">g_main_loop_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="n">GPPClient</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">gpp_client_new</span> <span class="p">();</span>

  <span class="n">g_unix_signal_add_full</span> <span class="p">(</span><span class="n">G_PRIORITY_HIGH</span><span class="p">,</span> <span class="n">SIGINT</span><span class="p">,</span> <span class="p">(</span><span class="n">GSourceFunc</span><span class="p">)</span> <span class="n">interrupted_cb</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">"request-handled"</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">task_done_cb</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">gpp_client_send_request</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">make_new_task</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">g_main_loop_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">client</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>

<p><h3 id='AdHVkn' class='subsection'><u>Methods:</u></h3></p>

<div class='prototype_start'></div>

<h3 id="gpp.client.new" c_name="gpp_client_new">GPP.Client.new</h3>
<pre class="highlight c"><code><span class="n">GPPClient</span><span class="o">*</span> <span class="n">gpp_client_new</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

</code></pre>

<p><em>Returns</em>: the newly-created <a href="#gpp.client">GPP.Client</a>.</p>

<div class='prototype_end'></div>

<p>Create a new <a href="#gpp.client">GPP.Client</a>.
Use it to send requests with <a href="#gpp.client.send_request">GPP.Client.send_request</a></p>

<div class='prototype_start'></div>

<h3 id="gpp.client.send_request" c_name="gpp_client_send_request" python_name="GPP.Client.send_request">GPP.Client.send_request</h3>
<pre class="highlight c"><code><span class="n">gboolean</span> <span class="n">gpp_client_send_request</span> <span class="p">(</span><span class="n">GPPClient</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span>
                                  <span class="k">const</span> <span class="n">gchar</span><span class="o">*</span> <span class="n">request</span><span class="p">,</span>
                                  <span class="n">gint</span> <span class="n">retries</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="nd">@accepts</span><span class="p">(</span><span class="n">GPP</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">retries</span><span class="p">):</span>
    <span class="c"># Python wrapper for gpp_client_send_request()</span>

</code></pre>

<p><em>self</em>: A <a href="#gpp.client">GPP.Client</a> that will send the request.</p>

<p><em>request</em>: A simple string that will be passed to the <a href="#gpp.worker">GPP.Worker</a>.</p>

<p><em>retries</em>: The number of times to retry before signaling that
the request was handled, -1 means retry forever.</p>

<p><em>Returns</em>: <strong>TRUE</strong> if <strong>request</strong> was made, <strong>FALSE</strong> if one is already being made.</p>

<div class='prototype_end'></div>

<p>This will make <strong>self</strong> send <strong>request</strong> to a <a href="#gpp.queue">GPP.Queue</a>.</p>

<h3 id='aClCSP' class='subsection'><u>Signals:</u></h3>

<div class='prototype_start'></div>

<h3 id="gpp.client-request-handled" c_name="gpp_client-request-handled" python_name="GPP.Client-request-handled">GPP.Client-request-handled</h3>
<pre class="highlight c"><code><span class="kt">void</span> <span class="n">request</span><span class="o">-</span><span class="n">handled</span> <span class="p">(</span><span class="n">gboolean</span> <span class="n">success</span><span class="p">,</span>
                      <span class="n">gchar</span><span class="o">*</span> <span class="n">reply</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">reply</span><span class="p">,</span> <span class="n">user_param1</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

</code></pre>

<p><em>success</em>: Whether the request was successfully executed</p>

<p><em>reply</em>: The reply provided by the <a href="#gpp.worker">GPP.Worker</a> , as a simple string</p>

<div class='prototype_end'></div>

<p>Connect to this signal to be notified when the current request
has been handled.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>

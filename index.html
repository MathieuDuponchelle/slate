<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["python","c"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="c">c</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="introduction">Introduction</h1>

<p>Welcome to the GObject Paranoid Pirate (GPP) documentation.</p>

<p>GPP is a simple GObject implementation of the <a href="http://rfc.zeromq.org/spec:6">Paranoid Pirate Pattern</a>,
which uses zeromq internally.</p>

<p>GPP is <em>not</em> a zeromq GLib wrapper.</p>

<p>It provides a <a href="#gpp.queue">GPP.Queue</a> object, which relays requests from a <a href="#gpp.client">GPP.Client</a> to a <a href="#gpp.worker">GPP.Worker</a>, and replies
from the worker to the client, as simple strings.</p>

<p>It implements heartbeating, which means that if a worker fails in some way, the client will be able
to make its request again, with a per-request retries limit.</p>

<p>Workers are picked on a least-recently-used basis.</p>

<p>One can indifferently instantiate and use all these objects in the same process or in separate ones.</p>

<p>It doesn&rsquo;t implement client prioritization, this is up to the user.</p>

<p>This documentation is intended as a quick guide and API reference.</p>

          <h2 id="gpp.queue" c_name="GPPQueue" python_name="GPP.Queue">GPP.Queue</h2>

<p class="graphviz">
<!-- Generated by graphviz version 2.38.0 (20140413.2041) --><!-- Title: %3 Pages: 1 --><svg width="110pt" height="116pt" viewBox="0.00 0.00 110.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)"><title>%3</title><polygon fill="white" stroke="none" points="-4,4 -4,-112 106,-112 106,4 -4,4"/><!-- GObject.Object --><g id="node1" class="node"><title>GObject.Object</title><g id="a_node1"><a xlink:href="https://developer.gnome.org/gobject/unstable//gobject-The-Base-Object-Type.html#GObject" xlink:title="GObject.Object"><path fill="none" stroke="black" d="M90,-108C90,-108 12,-108 12,-108 6,-108 0,-102 0,-96 0,-96 0,-84 0,-84 0,-78 6,-72 12,-72 12,-72 90,-72 90,-72 96,-72 102,-78 102,-84 102,-84 102,-96 102,-96 102,-102 96,-108 90,-108"/><text text-anchor="middle" x="51" y="-86.3" font-family="Times,serif" font-size="14.00">GObject.Object</text></a></g></g><!-- GPP.Queue --><g id="node2" class="node"><title>GPP.Queue</title><g id="a_node2"><a xlink:href="#gpp.queue" xlink:title="GPP.Queue"><path fill="none" stroke="black" d="M79,-36C79,-36 23,-36 23,-36 17,-36 11,-30 11,-24 11,-24 11,-12 11,-12 11,-6 17,-0 23,-0 23,-0 79,-0 79,-0 85,-0 91,-6 91,-12 91,-12 91,-24 91,-24 91,-30 85,-36 79,-36"/><text text-anchor="middle" x="51" y="-14.3" font-family="Times,serif" font-size="14.00">GPP.Queue</text></a></g></g><!-- GObject.Object&#45;&gt;GPP.Queue --><g id="edge1" class="edge"><title>GObject.Object&#45;&gt;GPP.Queue</title><path fill="none" stroke="black" d="M51,-71.6966C51,-63.9827 51,-54.7125 51,-46.1124"/><polygon fill="black" stroke="black" points="54.5001,-46.1043 51,-36.1043 47.5001,-46.1044 54.5001,-46.1043"/></g></g></svg></p>

<p><a href="#gpp.queue">GPP.Queue</a> routes requests from <a href="#gpp.client">GPP.Client</a> (s) to <a href="#gpp.worker">GPP.Worker</a> (s).</p>

<blockquote>
<p>Set up and start a queue</p>
</blockquote>
<pre class="highlight c"><code><span class="cp">#include &lt;glib-unix.h&gt;
</span>
<span class="cp">#include "gpp.h"
</span>
<span class="k">static</span> <span class="n">gboolean</span>
<span class="nf">interrupted_cb</span> <span class="p">(</span><span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_main_loop_quit</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GPPQueue</span> <span class="o">*</span><span class="n">self</span> <span class="o">=</span> <span class="n">gpp_queue_new</span> <span class="p">();</span>
  <span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">g_main_loop_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>

  <span class="n">g_unix_signal_add_full</span> <span class="p">(</span><span class="n">G_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="n">SIGINT</span><span class="p">,</span> <span class="p">(</span><span class="n">GSourceFunc</span><span class="p">)</span> <span class="n">interrupted_cb</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">gpp_queue_start</span> <span class="p">(</span><span class="n">self</span><span class="p">);</span>
  <span class="n">g_main_loop_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>

<p>It will detect if a worker stopped answering heartbeats, and
inform the client it was working for if there was one.</p>

<p>It will pick workers on a least-recently-used basis.</p>

<p><h3 id='FtPglg' class='subsection'><u>Methods:</u></h3></p>

<div class='prototype_start'></div>

<h3 id="gpp.queue.new" c_name="gpp_queue_new">GPP.Queue.new</h3>
<pre class="highlight c"><code><span class="n">GPPQueue</span><span class="o">*</span> <span class="n">gpp_queue_new</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

</code></pre>

<p><em>Returns</em>: the newly-created <a href="#gpp.queue">GPP.Queue</a>.</p>

<div class='prototype_end'></div>

<p>Create a new <a href="#gpp.queue">GPP.Queue</a>, which doesn&rsquo;t yet listen to <a href="#gpp.worker">GPP.Worker</a> (s).
Start it with <a href="#gpp.queue.start">GPP.Queue.start</a></p>

<div class='prototype_start'></div>

<h3 id="gpp.queue.start" c_name="gpp_queue_start" python_name="GPP.Queue.start">GPP.Queue.start</h3>
<pre class="highlight c"><code><span class="n">gboolean</span> <span class="n">gpp_queue_start</span> <span class="p">(</span><span class="n">GPPQueue</span><span class="o">*</span> <span class="n">self</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="nd">@accepts</span><span class="p">(</span><span class="n">GPP</span><span class="o">.</span><span class="n">Queue</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Python wrapper for gpp_queue_start()</span>

</code></pre>

<p><em>self</em>: A <a href="#gpp.queue">GPP.Queue</a> to start.</p>

<p><em>Returns</em>: <strong>TRUE</strong> if the queue was started, <strong>FALSE</strong> if it was already.</p>

<div class='prototype_end'></div>

<p>Makes <strong>self</strong> start to route requests to available workers,
and check worker&rsquo;s liveness.</p>

          <h2 id="gpp.worker" c_name="GPPWorker" python_name="GPP.Worker">GPP.Worker</h2>

<p class="graphviz">
<!-- Generated by graphviz version 2.38.0 (20140413.2041) --><!-- Title: %3 Pages: 1 --><svg width="110pt" height="116pt" viewBox="0.00 0.00 110.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)"><title>%3</title><polygon fill="white" stroke="none" points="-4,4 -4,-112 106,-112 106,4 -4,4"/><!-- GObject.Object --><g id="node1" class="node"><title>GObject.Object</title><g id="a_node1"><a xlink:href="https://developer.gnome.org/gobject/unstable//gobject-The-Base-Object-Type.html#GObject" xlink:title="GObject.Object"><path fill="none" stroke="black" d="M90,-108C90,-108 12,-108 12,-108 6,-108 0,-102 0,-96 0,-96 0,-84 0,-84 0,-78 6,-72 12,-72 12,-72 90,-72 90,-72 96,-72 102,-78 102,-84 102,-84 102,-96 102,-96 102,-102 96,-108 90,-108"/><text text-anchor="middle" x="51" y="-86.3" font-family="Times,serif" font-size="14.00">GObject.Object</text></a></g></g><!-- GPP.Worker --><g id="node2" class="node"><title>GPP.Worker</title><g id="a_node2"><a xlink:href="#gpp.worker" xlink:title="GPP.Worker"><path fill="none" stroke="black" d="M82.5,-36C82.5,-36 19.5,-36 19.5,-36 13.5,-36 7.5,-30 7.5,-24 7.5,-24 7.5,-12 7.5,-12 7.5,-6 13.5,-0 19.5,-0 19.5,-0 82.5,-0 82.5,-0 88.5,-0 94.5,-6 94.5,-12 94.5,-12 94.5,-24 94.5,-24 94.5,-30 88.5,-36 82.5,-36"/><text text-anchor="middle" x="51" y="-14.3" font-family="Times,serif" font-size="14.00">GPP.Worker</text></a></g></g><!-- GObject.Object&#45;&gt;GPP.Worker --><g id="edge1" class="edge"><title>GObject.Object&#45;&gt;GPP.Worker</title><path fill="none" stroke="black" d="M51,-71.6966C51,-63.9827 51,-54.7125 51,-46.1124"/><polygon fill="black" stroke="black" points="54.5001,-46.1043 51,-36.1043 47.5001,-46.1044 54.5001,-46.1043"/></g></g></svg></p>

<p><a href="#gpp.worker">GPP.Worker</a> receives requests from a <a href="#gpp.queue">GPP.Queue</a>, transmits them
as a simple string to the user, and notifies the queue when the
user marks the task as done.</p>

<blockquote>
<p>Set up and start a simple worker, which will take a lot of time to multiply the request by 2, and sometimes inexplicably fail.</p>
</blockquote>
<pre class="highlight c"><code><span class="cp">#include &lt;glib-unix.h&gt;
</span>
<span class="cp">#include "gpp.h"
</span>
<span class="cp">#define FAILURE_ODDS 4
</span>
<span class="cp">#define GPP_TYPE_MULTIPLYING_WORKER (gpp_multiplying_worker_get_type ())
</span>
<span class="n">G_DECLARE_FINAL_TYPE</span> <span class="p">(</span><span class="n">GPPMultiplyingWorker</span><span class="p">,</span> <span class="n">gpp_multiplying_worker</span><span class="p">,</span> <span class="n">GPP</span><span class="p">,</span>
    <span class="n">MULTIPLYING_WORKER</span><span class="p">,</span> <span class="n">GPPWorker</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">_GPPMultiplyingWorker</span>
<span class="p">{</span>
  <span class="n">GPPWorker</span> <span class="n">parent</span><span class="p">;</span>
  <span class="n">GRand</span> <span class="o">*</span><span class="n">rand_source</span><span class="p">;</span>
  <span class="n">gchar</span> <span class="o">*</span><span class="n">reply</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span> <span class="p">(</span><span class="n">GPPMultiplyingWorker</span><span class="p">,</span> <span class="n">gpp_multiplying_worker</span><span class="p">,</span> <span class="n">GPP_TYPE_WORKER</span><span class="p">);</span>

<span class="k">static</span> <span class="n">gboolean</span>
<span class="nf">set_task_done</span> <span class="p">(</span><span class="n">GPPMultiplyingWorker</span> <span class="o">*</span> <span class="n">self</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_print</span> <span class="p">(</span><span class="s">"one task done</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">g_rand_int</span> <span class="p">(</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">rand_source</span><span class="p">)</span> <span class="o">%</span> <span class="n">FAILURE_ODDS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"Actually it didn't work sorry</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">gpp_worker_set_task_done</span> <span class="p">(</span><span class="n">GPP_WORKER</span> <span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"no problem !!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">gpp_worker_set_task_done</span> <span class="p">(</span><span class="n">GPP_WORKER</span> <span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="n">self</span><span class="o">-&gt;</span><span class="n">reply</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">gboolean</span>
<span class="nf">handle_request</span> <span class="p">(</span><span class="n">GPPWorker</span> <span class="o">*</span> <span class="n">worker</span><span class="p">,</span> <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">request</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GPPMultiplyingWorker</span> <span class="o">*</span><span class="n">self</span> <span class="o">=</span> <span class="n">GPP_MULTIPLYING_WORKER</span> <span class="p">(</span><span class="n">worker</span><span class="p">);</span>
  <span class="n">g_print</span> <span class="p">(</span><span class="s">"doing one task, request is %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">request</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">g_rand_int</span> <span class="p">(</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">rand_source</span><span class="p">)</span> <span class="o">%</span> <span class="n">FAILURE_ODDS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"I can't even start</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">self</span><span class="o">-&gt;</span><span class="n">reply</span> <span class="o">=</span> <span class="n">g_strdup_printf</span> <span class="p">(</span><span class="s">"Result : %d"</span><span class="p">,</span> <span class="n">atoi</span> <span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">g_timeout_add</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="p">(</span><span class="n">GSourceFunc</span><span class="p">)</span> <span class="n">set_task_done</span><span class="p">,</span> <span class="n">self</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">gpp_multiplying_worker_class_init</span> <span class="p">(</span><span class="n">GPPMultiplyingWorkerClass</span> <span class="o">*</span> <span class="n">klass</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GPPWorkerClass</span> <span class="o">*</span><span class="n">gpp_worker_class</span> <span class="o">=</span> <span class="n">GPP_WORKER_CLASS</span> <span class="p">(</span><span class="n">klass</span><span class="p">);</span>

  <span class="n">gpp_worker_class</span><span class="o">-&gt;</span><span class="n">handle_request</span> <span class="o">=</span> <span class="n">handle_request</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">gpp_multiplying_worker_init</span> <span class="p">(</span><span class="n">GPPMultiplyingWorker</span> <span class="o">*</span> <span class="n">self</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">self</span><span class="o">-&gt;</span><span class="n">rand_source</span> <span class="o">=</span> <span class="n">g_rand_new</span> <span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">gboolean</span>
<span class="nf">interrupted_cb</span> <span class="p">(</span><span class="n">GMainLoop</span> <span class="o">*</span> <span class="n">loop</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_main_loop_quit</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">g_main_loop_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="n">GPPMultiplyingWorker</span> <span class="o">*</span><span class="n">worker</span> <span class="o">=</span>
      <span class="n">g_object_new</span> <span class="p">(</span><span class="n">GPP_TYPE_MULTIPLYING_WORKER</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">g_unix_signal_add_full</span> <span class="p">(</span><span class="n">G_PRIORITY_HIGH</span><span class="p">,</span> <span class="n">SIGINT</span><span class="p">,</span> <span class="p">(</span><span class="n">GSourceFunc</span><span class="p">)</span> <span class="n">interrupted_cb</span><span class="p">,</span>
      <span class="n">loop</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">gpp_worker_start</span> <span class="p">(</span><span class="n">GPP_WORKER</span> <span class="p">(</span><span class="n">worker</span><span class="p">));</span>

  <span class="n">g_main_loop_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">worker</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>

<p><h3 id='JyvCnJ' class='subsection'><u>Methods:</u></h3></p>

<div class='prototype_start'></div>

<h3 id="gpp.worker.new" c_name="gpp_worker_new">GPP.Worker.new</h3>
<pre class="highlight c"><code><span class="n">GPPWorker</span><span class="o">*</span> <span class="n">gpp_worker_new</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

</code></pre>

<p><em>Returns</em>: the newly-created <a href="#gpp.worker">GPP.Worker</a>.</p>

<div class='prototype_end'></div>

<p>Create a new <a href="#gpp.worker">GPP.Worker</a>, which doesn&rsquo;t yet listen to request from
the <a href="#gpp.queue">GPP.Queue</a>.
Start it with <a href="#gpp.worker.start">GPP.Worker.start</a></p>

<div class='prototype_start'></div>

<h3 id="gpp.worker.start" c_name="gpp_worker_start" python_name="GPP.Worker.start">GPP.Worker.start</h3>
<pre class="highlight c"><code><span class="n">gboolean</span> <span class="n">gpp_worker_start</span> <span class="p">(</span><span class="n">GPPWorker</span><span class="o">*</span> <span class="n">self</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="nd">@accepts</span><span class="p">(</span><span class="n">GPP</span><span class="o">.</span><span class="n">Worker</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Python wrapper for gpp_worker_start()</span>

</code></pre>

<p><em>self</em>: A <a href="#gpp.worker">GPP.Worker</a> that will start handling requests.</p>

<p><em>Returns</em>: <strong>TRUE</strong> if <strong>self</strong> could be started, <strong>FALSE</strong> if it was already.</p>

<div class='prototype_end'></div>

<p>This will make <strong>self</strong> start handling requests.</p>

<div class='prototype_start'></div>

<h3 id="gpp.worker.set_task_done" c_name="gpp_worker_set_task_done" python_name="GPP.Worker.set_task_done">GPP.Worker.set_task_done</h3>
<pre class="highlight c"><code><span class="n">gboolean</span> <span class="n">gpp_worker_set_task_done</span> <span class="p">(</span><span class="n">GPPWorker</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span>
                                   <span class="k">const</span> <span class="n">gchar</span><span class="o">*</span> <span class="n">reply</span><span class="p">,</span>
                                   <span class="n">gboolean</span> <span class="n">success</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="nd">@accepts</span><span class="p">(</span><span class="n">GPP</span><span class="o">.</span><span class="n">Worker</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_task_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">,</span> <span class="n">success</span><span class="p">):</span>
    <span class="c"># Python wrapper for gpp_worker_set_task_done()</span>

</code></pre>

<p><em>self</em>: A <a href="#gpp.worker">GPP.Worker</a>.</p>

<p><em>reply</em>: A string that will be passed to the client.</p>

<p><em>success</em>: Whether the task was successfully handled.</p>

<p><em>Returns</em>: <strong>TRUE</strong> if the task was marked as done, <strong>FALSE</strong> otherwise.</p>

<div class='prototype_end'></div>

<p>Call this function when your worker has finished handling a task.</p>

<h3 id='uDUkkI' class='subsection'><u>Virtual Methods:</u></h3>

<div class='prototype_start'></div>

<h3 id="gpp.worker.do_handle_request" c_name="GPPWorkerClass:handle_request" python_name="GPP.Worker.do_handle_request">GPP.Worker.do_handle_request</h3>
<pre class="highlight c"><code><span class="n">gboolean</span> <span class="n">GPPWorkerClass</span><span class="o">-&gt;</span><span class="n">handle_request</span> <span class="p">(</span><span class="n">GPPWorker</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span>
                               <span class="k">const</span> <span class="n">gchar</span><span class="o">*</span> <span class="n">request</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="nd">@accepts</span><span class="p">(</span><span class="n">GPP</span><span class="o">.</span><span class="n">Worker</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

</code></pre>

<p><em>self</em>: the <a href="#gpp.worker">GPP.Worker</a></p>

<p><em>request</em>: The request to handle</p>

<p><em>Returns</em>: <strong>TRUE</strong> if the worker can handle that request, <strong>FALSE</strong> otherwise.</p>

<div class='prototype_end'></div>

<p>Implement this method to handle requests, requests <em>MUST</em> be
handled asynchronously as this method should not block, call
<a href="#gpp.worker.set_task_done">GPP.Worker.set_task_done</a> when the request has been handled.</p>

          <h2 id="gpp.client" c_name="GPPClient" python_name="GPP.Client">GPP.Client</h2>

<p class="graphviz">
<!-- Generated by graphviz version 2.38.0 (20140413.2041) --><!-- Title: %3 Pages: 1 --><svg width="110pt" height="116pt" viewBox="0.00 0.00 110.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)"><title>%3</title><polygon fill="white" stroke="none" points="-4,4 -4,-112 106,-112 106,4 -4,4"/><!-- GObject.Object --><g id="node1" class="node"><title>GObject.Object</title><g id="a_node1"><a xlink:href="https://developer.gnome.org/gobject/unstable//gobject-The-Base-Object-Type.html#GObject" xlink:title="GObject.Object"><path fill="none" stroke="black" d="M90,-108C90,-108 12,-108 12,-108 6,-108 0,-102 0,-96 0,-96 0,-84 0,-84 0,-78 6,-72 12,-72 12,-72 90,-72 90,-72 96,-72 102,-78 102,-84 102,-84 102,-96 102,-96 102,-102 96,-108 90,-108"/><text text-anchor="middle" x="51" y="-86.3" font-family="Times,serif" font-size="14.00">GObject.Object</text></a></g></g><!-- GPP.Client --><g id="node2" class="node"><title>GPP.Client</title><g id="a_node2"><a xlink:href="#gpp.client" xlink:title="GPP.Client"><path fill="none" stroke="black" d="M78,-36C78,-36 24,-36 24,-36 18,-36 12,-30 12,-24 12,-24 12,-12 12,-12 12,-6 18,-0 24,-0 24,-0 78,-0 78,-0 84,-0 90,-6 90,-12 90,-12 90,-24 90,-24 90,-30 84,-36 78,-36"/><text text-anchor="middle" x="51" y="-14.3" font-family="Times,serif" font-size="14.00">GPP.Client</text></a></g></g><!-- GObject.Object&#45;&gt;GPP.Client --><g id="edge1" class="edge"><title>GObject.Object&#45;&gt;GPP.Client</title><path fill="none" stroke="black" d="M51,-71.6966C51,-63.9827 51,-54.7125 51,-46.1124"/><polygon fill="black" stroke="black" points="54.5001,-46.1043 51,-36.1043 47.5001,-46.1044 54.5001,-46.1043"/></g></g></svg></p>

<p><a href="#gpp.client">GPP.Client</a> sends requests to a <a href="#gpp.queue">GPP.Queue</a>, and emits a signal
with the possible reply and the status of the task once it has been executed.</p>

<p>A per-request retry limit can be set when calling <a href="#gpp.client.send_request">GPP.Client.send_request</a></p>

<blockquote>
<p>Set up and start a simple client, which will send requests for numbers to be multiplied, and will not take &lsquo;No&rsquo; for an answer.</p>
</blockquote>
<pre class="highlight c"><code><span class="cp">#include &lt;glib-unix.h&gt;
#include "gpp.h"
</span>
<span class="k">static</span> <span class="n">gchar</span> <span class="o">*</span>
<span class="nf">make_new_task</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">sequence</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">gchar</span> <span class="o">*</span><span class="n">task</span> <span class="o">=</span> <span class="n">g_strdup_printf</span> <span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">sequence</span><span class="p">);</span>
  <span class="n">sequence</span><span class="o">++</span><span class="p">;</span>

  <span class="n">g_print</span> <span class="p">(</span><span class="s">"Doing task %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">task</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">task_done_cb</span> <span class="p">(</span><span class="n">GPPClient</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="n">gboolean</span> <span class="n">success</span><span class="p">,</span> <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">reply</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">unused</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"task failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">g_print</span> <span class="p">(</span><span class="s">"task succeeded : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">reply</span><span class="p">);</span>
  <span class="n">gpp_client_send_request</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">make_new_task</span> <span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">gboolean</span>
<span class="nf">interrupted_cb</span> <span class="p">(</span><span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_main_loop_quit</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">g_main_loop_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="n">GPPClient</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">gpp_client_new</span> <span class="p">();</span>

  <span class="n">g_unix_signal_add_full</span> <span class="p">(</span><span class="n">G_PRIORITY_HIGH</span><span class="p">,</span> <span class="n">SIGINT</span><span class="p">,</span> <span class="p">(</span><span class="n">GSourceFunc</span><span class="p">)</span> <span class="n">interrupted_cb</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">"request-handled"</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">task_done_cb</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">gpp_client_send_request</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">make_new_task</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">g_main_loop_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">client</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>

<p><h3 id='AdHVkn' class='subsection'><u>Methods:</u></h3></p>

<div class='prototype_start'></div>

<h3 id="gpp.client.new" c_name="gpp_client_new">GPP.Client.new</h3>
<pre class="highlight c"><code><span class="n">GPPClient</span><span class="o">*</span> <span class="n">gpp_client_new</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

</code></pre>

<p><em>Returns</em>: the newly-created <a href="#gpp.client">GPP.Client</a>.</p>

<div class='prototype_end'></div>

<p>Create a new <a href="#gpp.client">GPP.Client</a>.
Use it to send requests with <a href="#gpp.client.send_request">GPP.Client.send_request</a></p>

<div class='prototype_start'></div>

<h3 id="gpp.client.send_request" c_name="gpp_client_send_request" python_name="GPP.Client.send_request">GPP.Client.send_request</h3>
<pre class="highlight c"><code><span class="n">gboolean</span> <span class="n">gpp_client_send_request</span> <span class="p">(</span><span class="n">GPPClient</span><span class="o">*</span> <span class="n">self</span><span class="p">,</span>
                                  <span class="k">const</span> <span class="n">gchar</span><span class="o">*</span> <span class="n">request</span><span class="p">,</span>
                                  <span class="n">gint</span> <span class="n">retries</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="nd">@accepts</span><span class="p">(</span><span class="n">GPP</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="nd">@returns</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">retries</span><span class="p">):</span>
    <span class="c"># Python wrapper for gpp_client_send_request()</span>

</code></pre>

<p><em>self</em>: A <a href="#gpp.client">GPP.Client</a> that will send the request.</p>

<p><em>request</em>: A simple string that will be passed to the <a href="#gpp.worker">GPP.Worker</a>.</p>

<p><em>retries</em>: The number of times to retry before signaling that
the request was handled, -1 means retry forever.</p>

<p><em>Returns</em>: <strong>TRUE</strong> if <strong>request</strong> was made, <strong>FALSE</strong> if one is already being made.</p>

<div class='prototype_end'></div>

<p>This will make <strong>self</strong> send <strong>request</strong> to a <a href="#gpp.queue">GPP.Queue</a>.</p>

<h3 id='aClCSP' class='subsection'><u>Signals:</u></h3>

<div class='prototype_start'></div>

<h3 id="gpp.client-request-handled" c_name="gpp_client-request-handled" python_name="GPP.Client-request-handled">GPP.Client-request-handled</h3>
<pre class="highlight c"><code><span class="kt">void</span> <span class="n">request</span><span class="o">-</span><span class="n">handled</span> <span class="p">(</span><span class="n">gboolean</span> <span class="n">success</span><span class="p">,</span>
                      <span class="n">gchar</span><span class="o">*</span> <span class="n">reply</span><span class="p">);</span>

</code></pre>
<pre class="highlight python"><code><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">reply</span><span class="p">,</span> <span class="n">user_param1</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

</code></pre>

<p><em>success</em>: Whether the request was successfully executed</p>

<p><em>reply</em>: The reply provided by the <a href="#gpp.worker">GPP.Worker</a> , as a simple string</p>

<div class='prototype_end'></div>

<p>Connect to this signal to be notified when the current request
has been handled.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="c">c</a>
          </div>
      </div>
    </div>
  </body>
</html>
